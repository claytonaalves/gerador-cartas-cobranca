Dependências do projeto:

  - wkhtmltopdf

==========================================

Clayton,
 
Segue em anexo o layout da carta de cobranÃ§a. Coloquei em vermelho tudo que tem que ser puxado banco de dados do 
vigo a logo da empresa tambÃ©m. No terceiro parÃ¡grafo, coloco ali o dia que o sinal serÃ¡ cortado esta em azul 
para vocÃª localizar, aquela data ali coloco manualmente toda vez que vou gerar a carta, coloco sempre a 
data do corte 7 dias apÃ³s a emissÃ£o da carta.
 
Os filtros para gerar a carta seria o seguinte:
- seriam por situação de cliente, ativos, bloqueados ou desativados
- filtrar por período de cliente com boletos em aberto (filtrar da data inicial a data final)
- opção de filtro de cliente com apenas 01 boleto em aberto
- opção de filtro com um ou mais boletos em aberto
 
 
Preciso fazer carta hoje da empresa 02. Poderia gerar as cartas ai pra mim, seria de clientes ativos 
com um ou mais boletos em aberto do dia 01/01/1900 atÃ© o dia 25/10/2013.
 
Att.
Nilton Junior



==========================================

CREATE PROCEDURE GetFilteredData()
BEGIN
  DECLARE bDone INT;

  DECLARE var1 CHAR(16);    -- or approriate type
  DECLARE Var2 INT;
  DECLARE Var3 VARCHAR(50);

  DROP TEMPORARY TABLE IF EXISTS tblResults;
  CREATE TEMPORARY TABLE IF NOT EXISTS tblResults  (
    --Fld1 type,
    --Fld2 type,
    --...
  );


  DECLARE curs CURSOR FOR  SELECT something FROM somewhere WHERE some stuff;
  DECLARE CONTINUE HANDLER FOR NOT FOUND SET bDone = 1;
  OPEN curs;

  SET bDone = 0;
  REPEAT
    FETCH curs INTO var1,, b;

    IF whatever_filtering_desired
       -- here for whatever_transformation_may_be_desired
       INSERT INTO tblResults VALUES (var1, var2, var3 ...);
    END IF;
  UNTIL bDone END REPEAT;

  CLOSE curs;
  SELECT * FROM tblResults;
END


==========================================

17/02/2014

empresa 02 - Rio Cable Serviços
clientes ativos 
com 01 ou mais boletos em aberto até o dia 02/02/2014
aquela data do corte la dentro coloca dia 25/02/2014
aqui, nas ultimas cartas, estava saindo com a logo SISTEL, coloca pra puxar a logo que ta la no vigo da Rio Cable

==========================================

select 
   t1.numero,
   (datediff(curdate(), bol.vcto)) as dias_atraso,
   bol.nnumero, 
   bol.vcto, 
   bol.valor, 
   bol.nome, 
   t1.cidade, 
   t1.endereco, 
   t1.numero, 
   t1.bairro, 
   t1.telefone
from boletos bol
left join 
    (   select
            u.numero,
            u.bairro,
            u.telefone,
            u.endereco,
            u.cidade,
            count(*) as titulos_abertos
        from boletos b
        left join usuarios u using(numero)
        where 
            u.idempresa=1 and
            u.situacao in ('') and
            b.pago='0' and
            b.vcto between '2014-01-01' and '2014-02-28'
        group by (u.numero)
        order by u.nome 
    ) t1 on t1.numero=bol.numero
where 
    bol.pago='0' 
    and ((datediff(curdate(), bol.vcto)) between 60 and 90)
    and (t1.titulos_abertos between 1 and 3)
order by bol.numero, bol.vcto

